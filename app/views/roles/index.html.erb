<% if can? :read, :all %>
<p><span style='color:red'>You should not be allowed to view this if you are a guest</span></p>
<% end %>

  
  <div id='roleSearch' class="row col-sm-4">
    <div class="input-group">
      <input type="text" id='role_search' class="form-control">
      <span class="input-group-addon">
        <i class="fa fa-search"></i>
      </span>
    </div><!-- /input-group -->
  </div><!-- /.row -->
          
  <table id='roletable' class="table table-striped table-hover tablesorter">
    <thead>
      <tr>
        <th>#</th>
        <th><%= sortable 'last', 'Last Name' %></th>
        <th><%= sortable 'first', 'First Name' %></th>
        <th><%= sortable 'email', 'E-mail' %></th>
        <th><%= sortable 'roles_mask', 'Authorization Rights' %></th>
      </tr>
    </thead>
    <tbody id='role_table_body'>
      <% if @all_users %>
        <% counter = 0 %>
        <% @all_users.each do |user| %>
          <% counter += 1 %>
          <% if user.roles.include?('admin')
          <tr>
            <td><%= counter %><span hidden><%= user.id %></span></td>
            <td><%= user.last %></td>
            <td><%= user.first %></td>
            <td><%= user.email %></td>
            <td>
              <%= form_tag(roles_update_path(user), method: 'put') do %>
                <% for role in User::ROLES %>

                  <% if role == 'admin' && current_user.email == user.email %>
                    <%= check_box_tag "user[roles][#{role}]", role, user.roles.include?(role), {:name => "user[roles][]", disabled: true}%>
                    <%= hidden_field(:user, :roles, multiple: true, value: 'admin') %>
                  <% else %>
                    <%= check_box_tag "user[roles][#{role}]", role, user.roles.include?(role), {:name => "user[roles][]"}%>
                  <% end %>

                  <% if user.roles.include?(role) %>
                    <%= label_tag "user_roles_#{role}", role.humanize, class: 'makeGreen' %>
                  <% else %>
                    <%= label_tag "user_roles_#{role}", role.humanize %>
                  <% end %>
                <% end %>

                <%= hidden_field_tag "user[roles][]", "" %>
                <%= submit_tag "Update", class: 'btn btn-xs btn-warning' %>
              <% end %>
            </td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
